<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sertifikat Gen Pro - Dashboard</title>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;1,600&family=Great+Vibes&family=Montserrat:wght@400;600;800&family=Pinyon+Script&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <!-- Pre-encoded assets to bypass local file:// CORS taint inside Canvas/HTML2Canvas -->
    <script src="logo_b64.js"></script>
    <!-- Modular CSS UI -->
    <link rel="stylesheet" href="assets/css/variables.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/certificate.css">
    <link rel="stylesheet" href="assets/css/toast.css">
</head>
<body>

    <!-- Top Navigation Bar -->
    <nav class="navbar">
        <div class="brand">
            <img id="nav-brand-logo" alt="ADU Logo" style="height: 40px; width: auto; object-fit: contain;">

            <div class="brand-title" id="ui-title">ADU Sertifikat Generatori</div>
        </div>
        <div class="nav-actions" style="display: flex; align-items: center; gap: 10px;">
            <button onclick="toggleDarkMode()" id="btn-dark-mode" title="Tungi/Kunduzgi rejim" style="background: none; border: none; cursor: pointer; font-size: 18px; color: var(--text-muted); padding: 5px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.2s;">
                üåô
            </button>
            <label style="font-size: 13px; font-weight: 500; color: #64748b; margin: 0; white-space: nowrap;">Til / –Ø–∑—ã–∫ / Language:</label>
            <select id="lang" class="lang-selector" onchange="changeLanguage()">
                <option value="uz">üá∫üáø O'zbekcha</option>
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                <option value="en">üá¨üáß English</option>
            </select>
        </div>
    </nav>

    <!-- Main Application Flex Container -->
    <div class="app-container">

        <!-- Left Sidebar Structure (The 10/10 Form) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title" id="ui-control-title">Hujjat Sozlamalari</h2>
            </div>

            <div class="sidebar-content">

                <!-- Card 1: Visual / Template Config -->
                <div class="control-group">
                    <h3 class="group-title" id="ui-gVisual">üè¢ Visual Sozlamalar</h3>

                    <div class="form-row">
                        <label id="ui-template">Andoza (Dizayn)</label>
                        <select id="certTemplate" onchange="updateSinglePreview()"></select>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-row">
                            <label id="ui-doc-type">Hujjat turi</label>
                            <select id="docType" onchange="updateTemplate()">
                                <option value="Maqtov Yorlig'i">Maqtov Yorlig'i</option>
                                <option value="Tashakkurnoma">Tashakkurnoma</option>
                                <option value="Sertifikat">Sertifikat</option>
                            </select>
                        </div>
                        <div class="form-row color-picker-wrapper">
                            <label id="ui-color" class="color-picker-label">Asosiy rang</label>
                            <input type="color" id="primaryColor" value="#0f172a" oninput="updateColors()">
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 16px;">
                        <label id="ui-uniName">Muassasa nomi (Ixtiyoriy)</label>
                        <input type="text" id="uniName" placeholder="..." oninput="updateSinglePreview()">
                    </div>

                    <!-- NEW: Typography & Format & Bg Image -->
                    <div class="form-grid-2" style="margin-top: 16px;">
                        <div class="form-row">
                            <label id="ui-format">Hujjat Formati</label>
                            <select id="certFormat" onchange="updateSinglePreview()">
                                <option value="landscape" id="ui-fmLand">Landscape (Eniga)</option>
                                <option value="portrait" id="ui-fmPort">Portrait (Bo'yiga)</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label id="ui-nameFont">Ism Shrifti</label>
                            <select id="nameFont" onchange="updateSinglePreview()">
                                <option value="" id="ui-fnDef">Standart</option>
                                <option value="'Playfair Display', serif">Playfair Display</option>
                                <option value="'Great Vibes', cursive">Great Vibes</option>
                                <option value="'Pinyon Script', cursive">Pinyon Script</option>
                                <option value="'Cormorant Garamond', serif">Garamond</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row" style="margin-top: 16px;">
                        <label id="ui-cusBg">Maxsus Orqa Fon Rasmi</label>
                        <div class="file-upload-wrapper">
                            <label for="bgUpload" class="file-upload-label" id="lbl-bg"><span id="ui-lblBg">üìÇ Surat (.jpg, .png)</span></label>
                            <input type="file" id="bgUpload" accept="image/*" onchange="updateFileLabel(this, 'lbl-bg'); uploadImage(event, 'bg')">
                        </div>
                        <p style="margin: 5px 0 0; font-size: 11px; color:#64748b; text-align:right;">
                            <a href="#" onclick="clearCustomBg(); return false;" id="ui-clearBg" style="color:var(--primary-color);">Fonni o'chirish / Reset</a>
                        </p>
                    </div>
                </div>

                <!-- Card 2: Personal Information -->
                <div class="control-group">
                    <h3 class="group-title" id="ui-gPersonal">üìù Shaxsiy Ma'lumot</h3>

                    <div class="form-row">
                        <label id="ui-name">Qabul qiluvchi (F.I.Sh)</label>
                        <input type="text" id="recipientName" placeholder="Ism-sharif kiritng..." oninput="updateSinglePreview()">
                    </div>

                    <div class="form-row">
                        <label id="ui-reason">Sabab / Matn</label>
                        <textarea id="reasonText" rows="3" placeholder="Sertifikat nima uchun berilyotganini yozing..." oninput="updateSinglePreview()"></textarea>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-row">
                            <label id="ui-reg">Qayd raqami</label>
                            <input type="text" id="regNumber" placeholder="Masalan: 001/25" oninput="updateSinglePreview()">
                        </div>
                        <div class="form-row">
                            <label id="ui-date">Sana</label>
                            <input type="text" id="dateText" placeholder="DD.MM.YYYY" oninput="updateSinglePreview()">
                        </div>
                    </div>
                </div>

                <!-- Card 3: Signature & Seal -->
                <div class="control-group">
                    <h3 class="group-title" id="ui-gConfirm">‚úçÔ∏è Tasdiq Qismi</h3>

                    <div class="form-grid-2">
                        <div class="form-row">
                            <label id="ui-rectorTitle">Imzolovchi Lavozimi</label>
                            <input type="text" id="rectorTitle" placeholder="..." oninput="updateSinglePreview()">
                        </div>
                        <div class="form-row">
                            <label id="ui-rector">Imzolovchi Ismi</label>
                            <input type="text" id="rectorName" placeholder="..." oninput="updateSinglePreview()">
                        </div>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-row">
                            <label id="ui-seal">Muhr Yuklash</label>
                            <div class="file-upload-wrapper">
                                <label for="sealUpload" class="file-upload-label" id="lbl-seal"><span id="ui-lblSeal">üìÇ Muhr (.png)</span></label>
                                <input type="file" id="sealUpload" accept="image/*" onchange="updateFileLabel(this, 'lbl-seal'); uploadImage(event, 'seal')">
                            </div>
                        </div>
                        <div class="form-row">
                            <label id="ui-sig">Imzo Yuklash</label>
                            <div class="file-upload-wrapper">
                                <label for="sigUpload" class="file-upload-label" id="lbl-sig"><span id="ui-lblSig">üìÇ Imzo (.png)</span></label>
                                <input type="file" id="sigUpload" accept="image/*" onchange="updateFileLabel(this, 'lbl-sig'); uploadImage(event, 'sig')">
                            </div>
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 12px;">
                        <label id="ui-logo">Tashkilot Logotipi (Ixtiyoriy)</label>
                        <div class="file-upload-wrapper">
                            <label for="logoUpload" class="file-upload-label" id="lbl-logo"><span id="ui-lblLogo">üñº Logo (.png)</span></label>
                            <input type="file" id="logoUpload" accept="image/*" onchange="updateFileLabel(this, 'lbl-logo'); uploadImage(event, 'logo')">
                        </div>
                    </div>
                </div>

                <!-- Card 4: Excel Batch Generation -->
                <div class="control-group batch-zone">
                    <h3 class="group-title" style="color: #166534;" id="ui-gBatch">üìä Ommaviy Yaratish</h3>

                    <div class="form-row">
                        <label id="ui-batch" style="color: #15803d;">Excel Bazani Yuklash</label>
                        <div class="file-upload-wrapper">
                            <label for="excelUpload" class="file-upload-label" id="lbl-batch">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <span id="ui-lblExcel">Excel (.xlsx) faylini tanlang</span>
                            </label>
                            <input type="file" id="excelUpload" accept=".xlsx, .xls, .csv" onchange="updateFileLabel(this, 'lbl-batch'); handleExcel(event)">
                        </div>
                        <p class="batch-hint text-xs" id="ui-batchHint" style="font-size: 11px; margin-top: 5px; color: #64748b;">Asosiy ustunlar: Ism, Sana, Reg, Matn, Rektor.<br>* Lavozim, Tashkilot kiritilmasa andozadagi olinadi.<br>* <b style="color:var(--primary-color)">Yangi:</b> Matnlarni sichqonchada (yoki ALT bosib) surib joyini o'zgartirishingiz mumkin.</p>
                        <div style="margin-top: 15px; border-top: 1px dashed rgba(0,0,0,0.1); padding-top: 15px;">
                            <button class="btn btn-primary" onclick="addBlankCertificate()" id="ui-btn-addBatch" style="width: 100%; background: #0f172a; border:none; color: white;">‚ûï Hujjat qo'shish</button>
                        </div>
                    </div>
                </div>

            </div> <!-- End Sidebar Content -->


            <div class="sidebar-footer" style="position: absolute; bottom: 0; left: 0; right: 0; z-index: 50; padding: 15px 24px; display: flex; flex-direction: column; gap: 12px; background: rgba(248, 250, 252, 0.95); backdrop-filter: blur(5px); border-top: 1px dashed var(--border-color);">
                <div class="form-grid-2" style="align-items: stretch;">
                    <button class="btn btn-secondary" onclick="saveDraft()" id="ui-btn-draftSave" style="margin:0; font-size:11px; padding: 12px 8px; line-height: 1.4; text-align: center; height: 100%;">üíæ<br>Qoralamani Saqlash</button>
                    <div class="file-upload-wrapper" style="margin:0; height: 100%;">
                        <label for="draftUpload" class="btn btn-secondary" id="ui-btn-draftLoad" style="margin:0; font-size:11px; padding: 12px 8px; line-height: 1.4; height: 100%; width: 100%; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;">üìÇ<br>Qoralama Yuklash</label>
                        <input type="file" id="draftUpload" accept=".adu" onchange="loadDraft(event)" style="display: none;">
                    </div>
                </div>
                <button class="btn" onclick="clearSettings()" id="ui-btn-clear" style="width: 100%; margin: 0; background: var(--bg-surface); color: #ef4444; border: 1px solid var(--border-color); box-shadow: var(--shadow-sm); font-size: 13px;">üóëÔ∏è Keshni Tozalash / Reset</button>
            </div>
        </aside>

        <!-- Right Preview Workspace -->
        <main class="preview-area" id="previewArea">

            <!-- Global Action Buttons -->
            <div class="action-panel">
                <button class="btn btn-secondary" onclick="window.print()" id="ui-btn-print">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    Chop etish (Print)
                </button>
                <button class="btn btn-primary" onclick="downloadPDF()" id="ui-btn-download">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    PDF qilib saqlash
                </button>
                <button class="btn btn-primary" onclick="downloadZIP()" id="ui-btn-zip" style="background: #15803d; border: none;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    ZIP Rasm Qilib Saqlash
                </button>

            </div>

            <!-- The generated certificates will be injected here -->
            <div id="previewContainer" style="display: flex; flex-direction: column; gap: 60px; align-items: center; width: 100%;"></div>

        </main>
    </div>

    <!-- Core & Utils -->
    <script src="js/utils/i18n.js"></script>
    <script src="js/utils/toast.js"></script>
    <script src="js/core/dom.js"></script>
    <script src="js/core/storage.js"></script>
    <script src="js/core/drag.js"></script>

    <!-- Features -->
    <script src="js/features/xlsx.js"></script>
    <script src="js/features/export.js"></script>
    <script src="js/features/feedback.js"></script>
    <script src="js/features/theme.js"></script>

    <!-- Main Entry -->
    <script src="js/main.js"></script>
</body>
</html>
